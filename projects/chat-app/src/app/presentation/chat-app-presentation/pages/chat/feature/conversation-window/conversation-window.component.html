<kaa-conversation-core
  [conversationPresentationData]="conversationWindowFacade.channelData()!"
  (sendMessage)="conversationWindowFacade.sendMessage($event)"
  (inputValueChanges)="conversationWindowFacade.channelTyping()"
  (onBlurInput)="conversationWindowFacade.channelStopTyping()">
  <ui-vertical-scroll>
    @if (conversationWindowFacade.messagesCollection(); as messagesCollection) {
      @for (message of messagesCollection; track message) {
        @if (!message.user.isCurrentUser) {
          <ui-avatar-with-text-cloud
            [color]="message.user.isCurrentUser | cloudColor"
            [position]="message.user.isCurrentUser | cloudPosition">
            <img ui-avatar [src]="message.user.photoURL" size="small" />
            <span>{{ message.text }}</span>
          </ui-avatar-with-text-cloud>
        } @else {
          <ui-text-cloud
            [color]="message.user.isCurrentUser | cloudColor"
            [position]="message.user.isCurrentUser | cloudPosition"
            >{{ message.text }}
          </ui-text-cloud>
        }
      }
    } @else {
      <div class="skeletons-wrapper">
        @for (_ of [].constructor(8); track _) {
          <ui-skeleton-bar class="skeleton" width="15" height="2" />
          <ui-skeleton-bar class="skeleton" width="9" height="3" />
          <ui-skeleton-bar class="skeleton" width="7" height="2" />
          <ui-skeleton-bar class="skeleton" width="8" height="2" />
        }
      </div>
    }

    @if (conversationWindowFacade.isTyping()) {
      <ui-typing-indicator />
    }
  </ui-vertical-scroll>
</kaa-conversation-core>
